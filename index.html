<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yandex GPT Demo</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
</head>
<body>
<div class="container " style="margin-top: 20px;">
    <div class="section center-align">
        <h4>Попробуйте Yandex GPT</h4>
        <p style="color:rgba(0,0,0,0.3); font-size: .8rem">gpt model - version 2</p>
    </div>

    <div class="row section valign-wrapper">
        <div class="input-field col s12">
            <input id="question" type="text" class="validate" placeholder="Ваш вопрос">
        </div>
        <button class="btn waves-effect waves-light pulse" type="submit" name="action" id="submit-btn">Подтвердить</button>
    </div>
    <div class="row">
        <div id="response" class="col s12" style="border: 1px solid rgba(0,0,0,0.3); border-radius: 10px; padding: 10px;">
            <label>Ответ от Yandex GPT</label>
            <p id="your-question"></p>
            <p id="gpt-response"></p>
        </div>
    </div>
    <p class="center-align" style="color:rgba(0,0,0,0.3); font-size: .8rem">Made by Victoria Stepanova</p>
</div>

<script type="module">
    export const PROXY_URL = 'https://thingproxy.freeboard.io/fetch/'; //для избежания проблем с CORS
    export const API_URL = 'https://llm.api.cloud.yandex.net/foundationModels/v1/completion'; // Замените на ваш URL
    //токен необходимо менять каждые 12 часов
    export const IAM_TOKEN = 't1.9euelZrMjI-KypnGjomeiZWVkZbJx-3rnpWaj8jJzZrHnpyOjIyNm8zMnJHl9Pc6DCdO-e9ARleT3fT3ejokTvnvQEZXk83n9euelZqax42Vk5KRxs2PlpGdk5vOyu_8xeuelZqax42Vk5KRxs2PlpGdk5vOyg.59V3enQKDupbnhxI2D_qEr9SjyY2bR4OiCAwggSjHivHxii3NbQSLcTuPhb0J4XNyrxWHL_8tlijmOTycn4CCA';
    export const FOLDER_ID = 'b1gpk33mjeuna2237k6p';


    document.getElementById('submit-btn').addEventListener('click', function() {
        const input = document.getElementById('question');
        const gptResponse = document.getElementById('gpt-response');
        const question = input.value;

        input.value = '';
        document.getElementById('your-question').innerHTML = '<b>Вопрос:</b> ' + question;
        gptResponse.innerText = 'Загрузка...';

        const data = {
            modelUri: `gpt://${FOLDER_ID}/yandexgpt-lite`,
            completionOptions: {
                stream: false,
                temperature: 0.1,
                maxTokens: "200"
            },
            messages: [
                {
                    role: "system",
                    text: "Отвечай как самый умный человек на свете"
                },
                {
                    role: "user",
                    text: question
                }
            ]
        };

        fetch(PROXY_URL + API_URL, {
            method: 'POST',
            headers: {
                'Authorization': 'Bearer ' + IAM_TOKEN,
                'x-folder-id': FOLDER_ID,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
            .then(response => response.json())
            .then(data => {
                gptResponse.innerHTML = '<b>Ответ:</b> ' + data.result.alternatives[0].message.text;
            })
            .catch(error => console.error('Error:', error));
    });
</script>
</body>
</html>
